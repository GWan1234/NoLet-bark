import{h as e,j as t,i as o,u as r,k as i,r as n,B as s,l as a,m as l,f as c,n as d,b as u,o as x,p as h,C as f,L as p,q as m,D as y,V as g,I as v,s as j,t as b,v as w,T as z,w as C,e as k,a as S,O as $,x as O,y as D,z as I,g as T,d as A,E as M,F as E,U as R,G as W}from"./popup-MtofvLJi.js";import{w as H,C as _,E as Y,H as L}from"./clipboardWrite-DiZlfjDk.js";const U=e(t.jsx("path",{d:"M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"})),B=e(t.jsx("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})),N=e(t.jsx("path",{d:"M9.4 16.6 4.8 12l4.6-4.6L8 6l-6 6 6 6zm5.2 0 4.6-4.6-4.6-4.6L16 6l6 6-6 6z"})),F=e([t.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),t.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")]),P=e(t.jsx("path",{d:"M5 4v3h5.5v12h3V7H19V4z"}));var J,Z,G,V,K={exports:{}};const q=o((J||(J=1,K.exports=(Z="minute",G=/[+-]\d\d(?::?\d\d)?/g,V=/([+-]|\d\d)/g,function(e,t,o){var r=t.prototype;o.utc=function(e){return new t({date:e,utc:!0,args:arguments})},r.utc=function(e){var t=o(this.toDate(),{locale:this.$L,utc:!0});return e?t.add(this.utcOffset(),Z):t},r.local=function(){return o(this.toDate(),{locale:this.$L,utc:!1})};var i=r.parse;r.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),i.call(this,e)};var n=r.init;r.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else n.call(this)};var s=r.utcOffset;r.utcOffset=function(e,t){var o=this.$utils().u;if(o(e))return this.$u?0:o(this.$offset)?s.call(this):this.$offset;if("string"==typeof e&&null===(e=function(e){void 0===e&&(e="");var t=e.match(G);if(!t)return null;var o=(""+t[0]).match(V)||["-",0,0],r=o[0],i=60*+o[1]+ +o[2];return 0===i?0:"+"===r?i:-i}(e)))return this;var r=Math.abs(e)<=16?60*e:e;if(0===r)return this.utc(t);var i=this.clone();if(t)return i.$offset=r,i.$u=!1,i;var n=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();return(i=this.local().add(r+n,Z)).$offset=r,i.$x.$localOffset=n,i};var a=r.format;r.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return a.call(this,t)},r.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},r.isUTC=function(){return!!this.$u},r.toISOString=function(){return this.toDate().toISOString()},r.toString=function(){return this.toDate().toUTCString()};var l=r.toDate;r.toDate=function(e){return"s"===e&&this.$offset?o(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():l.call(this)};var c=r.diff;r.diff=function(e,t,r){if(e&&this.$u===e.$u)return c.call(this,e,t,r);var i=this.local(),n=o(e).local();return c.call(i,n,t,r)}})),K.exports));var Q,X={exports:{}};var ee=(Q||(Q=1,X.exports=function(){var e={year:0,month:1,day:2,hour:3,minute:4,second:5},t={};return function(o,r,i){var n,s=function(e,o,r){void 0===r&&(r={});var i=new Date(e);return function(e,o){void 0===o&&(o={});var r=o.timeZoneName||"short",i=e+"|"+r,n=t[i];return n||(n=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:r}),t[i]=n),n}(o,r).formatToParts(i)},a=function(t,o){for(var r=s(t,o),n=[],a=0;a<r.length;a+=1){var l=r[a],c=l.type,d=l.value,u=e[c];u>=0&&(n[u]=parseInt(d,10))}var x=n[3],h=24===x?0:x,f=n[0]+"-"+n[1]+"-"+n[2]+" "+h+":"+n[4]+":"+n[5]+":000",p=+t;return(i.utc(f).valueOf()-(p-=p%1e3))/6e4},l=r.prototype;l.tz=function(e,t){void 0===e&&(e=n);var o,r=this.utcOffset(),s=this.toDate(),a=s.toLocaleString("en-US",{timeZone:e}),l=Math.round((s-new Date(a))/1e3/60),c=15*-Math.round(s.getTimezoneOffset()/15)-l;if(Number(c)){if(o=i(a,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(c,!0),t){var d=o.utcOffset();o=o.add(r-d,"minute")}}else o=this.utcOffset(0,t);return o.$x.$timezone=e,o},l.offsetName=function(e){var t=this.$x.$timezone||i.tz.guess(),o=s(this.valueOf(),t,{timeZoneName:e}).find(function(e){return"timezonename"===e.type.toLowerCase()});return o&&o.value};var c=l.startOf;l.startOf=function(e,t){if(!this.$x||!this.$x.$timezone)return c.call(this,e,t);var o=i(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return c.call(o,e,t).tz(this.$x.$timezone,!0)},i.tz=function(e,t,o){var r=o&&t,s=o||t||n,l=a(+i(),s);if("string"!=typeof e)return i(e).tz(s);var c=function(e,t,o){var r=e-60*t*1e3,i=a(r,o);if(t===i)return[r,t];var n=a(r-=60*(i-t)*1e3,o);return i===n?[r,i]:[e-60*Math.min(i,n)*1e3,Math.max(i,n)]}(i.utc(e,r).valueOf(),l,s),d=c[0],u=c[1],x=i(d).utcOffset(u);return x.$x.$timezone=s,x},i.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},i.tz.setDefault=function(e){n=e}}}()),X.exports);const te=o(ee);function oe({parameters:e}){const{t:o}=r(),{cleanupBlobs:u}=i(),[x,h]=n.useState(e.icon||"");return n.useEffect(()=>{let t=!0;return(async()=>{if(e.icon)try{u();const o=await d(e.icon,e.sendTimestamp);t&&h(o)}catch(o){console.error("加载 favicon 失败:",o),t&&h(e.icon||"")}else h("")})(),()=>{t=!1}},[e.icon,e.sendTimestamp,u]),t.jsx(s,{sx:{overflow:"hidden",position:"relative"},children:t.jsxs(a,{direction:"row",justifyContent:"space-between",alignItems:"flex-start",sx:{flex:1,border:"1px solid",borderColor:"divider",boxShadow:"0 0 6px 0 rgba(0, 0, 0, 0.01)",borderRadius:"1.25rem",py:1,px:.5,userSelect:"none",backgroundColor:"background.paper","&:hover":{boxShadow:"0 0 8px 0 rgba(0, 0, 0, 0.05)"}},children:[t.jsxs(a,{direction:"row",alignItems:"center",justifyContent:"flex-start",children:[t.jsxs(a,{sx:{position:"relative",pointerEvents:"none"},children:[t.jsx(a,{sx:{p:1,display:""!==x?"inherit":"none"},children:t.jsx("img",{src:""===x?"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==":x,alt:o("settings.avatar.preview"),style:{width:"2.625rem",height:"2.625rem",objectFit:"contain",borderRadius:"50%"}})}),x?t.jsx(s,{sx:{width:"1.25rem",height:"1.25rem",objectFit:"contain",position:"absolute",right:"0.125rem",bottom:"0.125rem",borderRadius:"20%",backgroundColor:"var(--u-icon-bg-color)"},children:t.jsx(s,{sx:{width:"1.25rem",height:"1.25rem",background:"var(--u-icon)"}})}):t.jsx(a,{sx:{p:1},children:t.jsx(s,{sx:{width:"2.625rem",height:"2.625rem",objectFit:"contain",borderRadius:"20%",backgroundColor:"var(--u-icon-bg-color)"},children:t.jsx(s,{sx:{width:"2.625rem",height:"2.625rem",background:"var(--u-icon)"}})})})]}),t.jsxs(a,{direction:"column",alignItems:"flex-start",justifyContent:"center",sx:{p:1},children:[t.jsx(l,{variant:"subtitle2",fontWeight:600,children:e.title||"NoLet"}),t.jsx(l,{variant:"body2",fontWeight:400,sx:{wordBreak:"break-word",display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical",WebkitLineClamp:2},children:e.body})]})]}),t.jsx(a,{sx:{p:1,pt:.5},children:t.jsx(l,{variant:"subtitle2",color:"text.secondary",children:c.tz(1e3*e.sendTimestamp,"YYYY-MM-DD HH:mm:ss",e.timezone).format("HH:mm")})})]})})}c.extend(q),c.extend(te),c.extend(q),c.extend(te);const re=({children:e})=>t.jsx(s,{sx:{width:"100%",height:"100%",isolation:"isolate",position:"relative",zIndex:1},children:e}),ie=({record:e})=>{const{t:o}=r();if("recalled"===e.status)return t.jsx(E,{icon:t.jsx(R,{}),label:o("history.table.recalled"),color:"warning",variant:"outlined",size:"small"});const i=e.responseJson?.code,n=e.responseJson?.message;if(200===i)return t.jsx(E,{icon:t.jsx(_,{}),label:`${i} OK`,color:"success",variant:"outlined",size:"small"});if(-1===i){console.log("responseMessage",n);const e=n.startsWith("HTTP error! status: ")?n.replace("HTTP error! status: ",""):n,r=e.startsWith("utils.api.")?o(e):e+" ERROR";return t.jsx(E,{icon:t.jsx(Y,{}),label:`${r}`,color:"error",variant:"outlined",size:"small",sx:{fontSize:"0.625rem"}})}return t.jsx(E,{icon:t.jsx(L,{}),label:i?`${i} ${o("common.other")}`:o("common.other"),color:"warning",variant:"outlined",size:"small"})},ne=({icon:e,label:o,value:r,fullWidth:i=!1,tooltip:n,enableCopy:c=!0,onCopy:d})=>{const x=u();return t.jsxs(s,{sx:{display:"flex",alignItems:i?"flex-start":"center",gap:2,py:1.5,flexDirection:i?"column":"row"},children:[t.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1,minWidth:i?"auto":120,color:x.palette.text.secondary},children:[e,t.jsx(l,{variant:"body2",fontWeight:500,children:o})]}),t.jsx(M,{title:n,arrow:!0,slotProps:{popper:{sx:{zIndex:9999}}},children:t.jsx(s,{sx:{flex:i?void 0:1,width:i?"100%":"auto"},children:t.jsxs(a,{direction:"row",gap:1,alignItems:"center",children:["string"==typeof r?t.jsx(l,{variant:"body2",sx:{wordBreak:"break-all",color:x.palette.text.primary},children:r}):r,"string"==typeof r&&c&&t.jsx(v,{onClick:()=>{d?.("string"==typeof r?r:JSON.stringify(r))},children:t.jsx(j,{sx:{fontSize:"0.875rem"}})})]})})})]})},se=({record:e,onDoubleClick:o,style:r,alt:i})=>{const[a,l]=n.useState(e.url||""),[c,d]=n.useState(!0);return n.useEffect(()=>{let t=!0;return(async()=>{if(e.uuid&&e.url)try{const o=await W(e.uuid);t&&(o?(console.debug("使用缓存图片:",o),l(o)):(console.debug("缓存中无图片，使用原始URL:",e.url),l(e.url||"")),d(!1))}catch(o){console.error("加载缓存图片失败:",o),t&&(l(e.url||""),d(!1))}else d(!1)})(),()=>{t=!1}},[e.uuid,e.url]),c?t.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",...r},children:t.jsx(m,{size:20})}):t.jsx("img",{src:a,alt:i||e.title||"Image",style:r,onDoubleClick:o,onError:t=>{a!==e.url&&e.url&&(console.warn("缓存图片加载失败，回退到原始URL"),l(e.url))}})};function ae({record:e,open:o,onClose:i,onExited:d,currentIndex:M,totalCount:E,onNavigate:R,onRecallSuccess:W,onRecordUpdate:_}){const{t:Y}=r(),L=u(),J=n.useRef(null),Z=n.useRef(null),[G,V]=n.useState(!1),[K,q]=n.useState({}),[Q,X]=n.useState({}),[ee,te]=n.useState(null),[ae,le]=n.useState(!1),[ce,de]=n.useState(!1),[ue,xe]=n.useState(!1),[he,fe]=n.useState(null);n.useEffect(()=>(J.current||(J.current=document.createElement("div"),J.current.id="record-detail-modal-portal",document.body.appendChild(J.current)),()=>{J.current&&document.body.contains(J.current)&&(document.body.removeChild(J.current),J.current=null)}),[]),n.useEffect(()=>{o?V(!0):(te(null),X({}),xe(!1),fe(null),de(!1))},[o]),n.useEffect(()=>{if(!e)return;const t=(e.parameters??[]).reduce((e,{key:t,value:o})=>(t&&(e[t]=o??""),e),{}),o=e.uuid??"",r=e.timezone??Intl.DateTimeFormat().resolvedOptions().timeZone;t.id=o,t.body=t.message??e.body??"",delete t.message,t.timezone=r;let i=Date.now();try{i=c.tz(e.createdAt,"YYYY-MM-DD HH:mm:ss",r).unix()}catch(s){console.warn("时间戳转换失败，使用当前时间:",s)}t.sendTimestamp=i,console.log("parameters",t,"record",e);const n=Object.fromEntries(Object.entries(t).filter(([e,t])=>!["timezone","sendTimestamp"].includes(e)&&""!==t));if(1===n?.autoCopy&&delete n.copy,n.device_keys){const e=(Array.isArray(n.device_keys)?n.device_keys:String(n.device_keys).split(",").map(e=>e.trim())).filter(Boolean);e.length>1?(n.device_keys=e,delete n.device_key):1===e.length?(n.device_key=e[0],delete n.device_keys):delete n.device_keys}X(n),q(t)},[e]);const pe=()=>document.getElementById("root")||document.body;if(!e||!J.current||!G)return null;const me=async e=>{try{await H(e,"txt"),le(!0)}catch(t){console.error("拷贝失败:",t)}},ye=t.jsxs(t.Fragment,{children:[t.jsx(s,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,display:"flex",flexDirection:"column",backgroundColor:x(L.palette.common.black,.4),opacity:o?1:0,transition:L.transitions.create("opacity",{duration:300,easing:"cubic-bezier(0.4, 0, 0.2, 1)"}),pointerEvents:G?"auto":"none"},onClick:i,children:t.jsx(h,{direction:"up",in:o,mountOnEnter:!0,unmountOnExit:!0,timeout:{enter:300,exit:300},onEnter:()=>{const e=pe();e.style.transition="transform 0.3s cubic-bezier(0.4, 0, 0.2, 1) ",e.style.transformOrigin="top",e.style.transform="scale(0.96) translateY(15px)",e.style.overflow="hidden",e.style.borderRadius="12px",e.style.overflow="hidden",document.body.style.overflow="hidden"},onExit:()=>{const e=pe();e.style.transform="scale(1)",e.style.borderRadius="0"},onExited:()=>{V(!1),pe().removeAttribute("style"),document.body.style.overflow="",d&&d()},children:t.jsx(s,{sx:{position:"absolute",bottom:0,left:0,right:0,height:"calc(100vh - 24px)"},onClick:e=>e.stopPropagation(),children:t.jsxs(f,{sx:{height:"100%",borderRadius:"14px 14px 0 0",boxShadow:L.shadows[24],backgroundColor:L.palette.background.paper,display:"flex",flexDirection:"column",overflow:"hidden"},children:[t.jsx(s,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:.5,pt:1,cursor:"pointer"},onClick:i}),t.jsxs(s,{sx:{px:2,pb:1.5,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:`1px solid ${x(L.palette.divider,.1)}`},children:[t.jsx(p,{onClick:i,sx:{cursor:"pointer",color:L.palette.primary.main,textDecoration:"none",userSelect:"none","&:hover":{color:L.palette.primary.main,opacity:.6},"&:active":{color:L.palette.primary.main,opacity:.5},flex:1},children:Y("common.close")}),t.jsx(a,{alignItems:"center",sx:{flex:1,fontWeight:600,fontSize:"1.0625rem"},children:Y("history.detail.title")}),t.jsx(a,{justifyContent:"flex-end",alignItems:"center",direction:"row",gap:1,flex:1,children:e&&t.jsxs(t.Fragment,{children:[ce&&t.jsx(m,{size:14,color:"warning"}),t.jsx(p,{component:"button",onClick:async()=>{if(!e||!e.uuid)return fe({type:"error",message:Y("push.recall.record_not_found")}),void xe(!0);de(!0);try{const t=await T(e.uuid);if(!t)return fe({type:"error",message:Y("push.recall.record_not_found")}),void xe(!0);const o=`${t.apiUrl}?id=${encodeURIComponent(e.uuid)}&delete=1`;console.debug("发送撤回请求到:",o);const r={};t.authorization&&t.authorization.value&&(r.Authorization=t.authorization.value);const i=await fetch(o,{method:"GET",mode:"cors",cache:"no-cache",...Object.keys(r).length>0&&{headers:r}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const n=await i.json();if(console.debug("撤回请求结果:",n),200===n.code){fe({type:"success",message:Y("push.recall.success")}),await A(e.uuid,"recalled");const t=await T(e.uuid);t&&_&&_(t),W?.()}else fe({type:"error",message:Y("push.recall.failed",{message:n.message||"未知错误"})})}catch(t){console.error(Y("push.recall.operation_failed"),t),fe({type:"error",message:Y("push.recall.failed",{message:t instanceof Error?t.message:"网络错误"})})}finally{de(!1),xe(!0)}},disabled:ce,sx:{cursor:"pointer",color:L.palette.primary.main,textDecoration:"none",userSelect:"none",fontWeight:500,"&:hover":{color:L.palette.primary.main,opacity:.6},"&:active":{color:L.palette.primary.main,opacity:.5}},children:Y("push.recall.button")})]})})]}),t.jsx(s,{sx:{px:3,py:1.5,pb:1},children:t.jsxs(a,{direction:"column",justifyContent:"center",sx:{m:0,position:"relative"},children:[t.jsx(a,{justifyContent:"center",alignItems:"flex-start",sx:{position:"absolute",left:"-24px",top:0,height:"100%",width:"48px",p:0,zIndex:1,borderRadius:"0 50% 50% 0","&:active .MuiSvgIcon-root":{scale:.9},"&:hover":{opacity:.6},cursor:"pointer",transition:"all .5s ease-in-out"},onClick:()=>R?.("prev"),children:t.jsx(U,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",opacity:R&&0!==M?.6:.1}})}),t.jsx(a,{justifyContent:"center",alignItems:"flex-end",sx:{position:"absolute",right:"-24px",top:0,height:"100%",width:"48px",p:0,zIndex:1,borderRadius:" 50% 0 0 50%","&:active .MuiSvgIcon-root":{scale:.6},"&:hover":{opacity:.6},cursor:"pointer",transition:"all .5s ease-in-out"},onClick:()=>R?.("next"),children:t.jsx(B,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center",opacity:R&&E&&M!==E-1?.6:.1}})}),t.jsx(oe,{parameters:K})]})}),t.jsx(s,{ref:Z,sx:{flex:1,overflow:"auto",p:3},children:t.jsx(re,{children:t.jsxs(a,{spacing:1,sx:{pb:8},children:[t.jsx(a,{children:t.jsx(s,{sx:{display:"flex",alignItems:"flex-start",gap:2,py:1.5,flexDirection:"column"},children:t.jsx(s,{sx:{width:"fit-content"},children:"image"===e?.inspectType&&e.url?t.jsxs(a,{direction:"row",gap:1,alignItems:"center",children:[t.jsx(s,{sx:{width:"105px",height:"105px",border:"1px solid",borderColor:"divider",backgroundColor:L.palette.action.hover,borderRadius:"4px"},children:t.jsx(se,{record:e,style:{width:"100%",height:"100%",objectFit:"contain"},onDoubleClick:()=>{e.url&&window.open(e.url,"_blank")}})}),t.jsx(v,{onClick:()=>{window.open(e.url,"_blank")},children:t.jsx($,{sx:{fontSize:"0.875rem"}})}),t.jsx(v,{onClick:()=>{me(e.url||"copy failed")},children:t.jsx(j,{sx:{fontSize:"0.875rem"}})})]}):e?.url?t.jsxs(a,{direction:"row",gap:1,alignItems:"center",children:[t.jsx(l,{variant:"body2",component:"a",href:e.url,target:"_blank",rel:"noopener noreferrer",sx:{color:L.palette.primary.main,textDecoration:"none",wordBreak:"break-all",display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical",WebkitLineClamp:3,"&:hover":{textDecoration:"underline"}},children:e.url||e.body}),t.jsxs(a,{direction:"row",gap:1,alignItems:"center",children:[t.jsx(v,{onClick:()=>{e.url&&window.open(e.url,"_blank")},children:t.jsx($,{sx:{fontSize:"0.875rem"}})}),t.jsx(v,{onClick:()=>{me(e.url||"copy failed")},children:t.jsx(j,{sx:{fontSize:"0.875rem"}})})]})]}):t.jsxs(a,{direction:"row",gap:1,alignItems:"center",children:[t.jsx(l,{variant:"body2",sx:{wordBreak:"break-word",display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical",WebkitLineClamp:3},children:e?.body||""}),t.jsx(a,{direction:"row",gap:1,alignItems:"center",children:t.jsx(v,{onClick:()=>{me(e?.body||"copy failed")},children:t.jsx(j,{sx:{fontSize:"0.875rem"}})})})]})})})}),t.jsx(y,{}),t.jsxs(a,{children:[e.title&&t.jsx(ne,{icon:t.jsx(P,{fontSize:"small"}),label:"标题",value:e.title,onCopy:me}),e.sound&&t.jsx(ne,{icon:t.jsx(g,{fontSize:"small"}),label:Y("history.detail.sound"),value:e.sound,onCopy:me}),e.url&&t.jsx(ne,{icon:t.jsx(b,{fontSize:"small"}),label:Y("history.detail.url"),value:t.jsxs(a,{direction:"row",gap:1,alignItems:"center",children:[t.jsx(l,{variant:"body2",component:"a",href:e.url,target:"_blank",rel:"noopener noreferrer",sx:{color:L.palette.primary.main,textDecoration:"none",wordBreak:"break-all",display:"-webkit-box",overflow:"hidden",WebkitBoxOrient:"vertical",WebkitLineClamp:1,"&:hover":{textDecoration:"underline"}},children:e.url}),t.jsx(v,{onClick:()=>{console.log("copy url",e.url),me(e.url||"copy failed")},children:t.jsx(j,{sx:{fontSize:"0.875rem"}})})]}),enableCopy:!1}),t.jsx(ne,{icon:t.jsx(w,{fontSize:"small"}),label:Y("history.detail.device"),value:e.deviceName,onCopy:me}),t.jsx(ne,{icon:t.jsx(F,{fontSize:"small"}),label:Y("history.detail.time"),value:e.createdAt,tooltip:K.timezone,onCopy:me})]}),t.jsx(y,{children:t.jsx(l,{sx:{my:1,fontSize:"0.625rem"},children:"更多信息"})}),!1===e.responseJson.message.startsWith("utils.api.")&&t.jsx(ne,{icon:t.jsx(b,{fontSize:"small"}),label:Y("history.detail.response"),value:e.responseJson.message,enableCopy:!1}),t.jsx(ie,{record:e}),Q&&t.jsxs(s,{children:[t.jsxs(l,{variant:"body2",fontWeight:500,sx:{mb:1,display:"flex",alignItems:"center",gap:1,color:L.palette.text.secondary},children:[t.jsx(N,{fontSize:"small"}),Y("history.detail.parameters")]}),t.jsxs(s,{sx:{position:"relative"},children:[t.jsx(z,{value:JSON.stringify(Q,null,2),multiline:!0,fullWidth:!0,minRows:3,maxRows:15,slotProps:{input:{style:{fontFamily:"monospace",fontSize:"0.75rem",overflow:"auto"}}}}),t.jsx(s,{sx:{position:"absolute",right:0,top:"-2rem"},children:t.jsx(v,{size:"small",onClick:()=>{me(JSON.stringify(Q,null,2))},children:t.jsx(j,{sx:{fontSize:"0.875rem"}})})})]}),e.isEncrypted&&t.jsx(C,{variant:"outlined",size:"small",onClick:()=>{(async e=>{try{const t=O(),o=JSON.stringify({body:e.body,title:e.title}),r=await D(),i=r.encryptionConfig?.key;if(!i)return console.error("未找到加密密钥"),null;const n=await I(o,i,t),s={...Q,iv:t,ciphertext:n};return delete s.body,te(s),Z.current&&setTimeout(()=>{Z.current?.scrollTo({top:Z.current.scrollHeight,behavior:"smooth"})},100),s}catch(t){return console.error("加密失败:",t),null}})(K)},sx:{mt:1},children:Y("history.detail.recreate_encrypted_btn")})]}),ee&&t.jsxs(s,{children:[t.jsxs(l,{variant:"body2",fontWeight:500,sx:{mb:1,display:"flex",alignItems:"center",gap:1,color:L.palette.text.secondary},children:[t.jsx(N,{fontSize:"small"}),Y("history.detail.recreate_encrypted_data")]}),t.jsxs(s,{sx:{position:"relative"},children:[t.jsx(z,{value:JSON.stringify(ee,null,2),multiline:!0,fullWidth:!0,minRows:3,maxRows:10,slotProps:{input:{style:{fontFamily:"monospace",fontSize:"0.75rem",overflow:"auto"}}}}),t.jsx(s,{sx:{position:"absolute",right:0,top:"-2rem"},children:t.jsx(v,{size:"small",onClick:()=>{me(JSON.stringify(ee,null,2))},children:t.jsx(j,{sx:{fontSize:"0.75rem"}})})})]})]}),e.authorization&&t.jsxs(s,{children:[t.jsxs(l,{variant:"body2",fontWeight:500,sx:{mb:1,display:"flex",alignItems:"center",gap:1,color:L.palette.text.secondary},children:[t.jsx(N,{fontSize:"small"}),Y("history.detail.authorization")]}),t.jsx(z,{value:JSON.stringify({user:e.authorization.user,pwd:e.authorization.pwd},null,2),multiline:!0,fullWidth:!0,minRows:3,maxRows:21,slotProps:{input:{style:{fontFamily:"monospace",fontSize:"0.75rem",overflow:"auto"}}}})]})]})})})]})})})}),t.jsx(k,{open:ae,autoHideDuration:1e3,onClose:()=>le(!1),message:"拷贝成功",anchorOrigin:{vertical:"bottom",horizontal:"center"},slotProps:{root:{sx:{zIndex:9999}}}}),t.jsx(k,{open:ue,autoHideDuration:3e3,onClose:()=>xe(!1),message:Y("push.recall.success"),anchorOrigin:{vertical:"bottom",horizontal:"center"},slotProps:{root:{sx:{zIndex:9999,"& .MuiSnackbarContent-root":{backgroundColor:"success"===he?.type?L.palette.warning.main:L.palette.error.main}}}}})]});return S.createPortal(ye,J.current)}export{ae as default};
